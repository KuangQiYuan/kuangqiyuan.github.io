<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="SOqsL8PexCDMo8ubmGTRngo5fAy0r6255DCMfRC5Bzg">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="simonkuang, blog, engineer, architecture, microservice, platform">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta property="og:type" content="website">
<meta property="og:title" content="旷{&lt;i&gt;氏&lt;&#x2F;i&gt; }淇元">
<meta property="og:url" content="http://i.am.simonkuang.com/page/2/index.html">
<meta property="og:site_name" content="旷{&lt;i&gt;氏&lt;&#x2F;i&gt; }淇元">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="旷{&lt;i&gt;氏&lt;&#x2F;i&gt; }淇元">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://i.am.simonkuang.com/page/2/">





  <title>旷{<i>氏</i> }淇元</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-45245769-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">旷{<i>氏</i> }淇元</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/all-the-ssl-providers-controlled-by-qihoo-are-loser-now/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/all-the-ssl-providers-controlled-by-qihoo-are-loser-now/" itemprop="url">数字公司旗下的 SSL 服务商好像被 block 完了</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T23:59:08+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/all-the-ssl-providers-controlled-by-qihoo-are-loser-now/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/all-the-ssl-providers-controlled-by-qihoo-are-loser-now/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>刚知道，<a href="https://support.apple.com/en-au/HT204132" target="_blank" rel="noopener">Apple 早在去年就开始 block Wosign 和 StartCom 作为根签发的 SSL 证书</a>。</p>
<p>继 <a href="https://www.bleepingcomputer.com/news/security/google-outlines-ssl-apocalypse-for-symantec-certificates/" target="_blank" rel="noopener">Symantec 被 google 亲儿子 chrome 拉黑</a>之后，感觉信息安全圈儿的很多事情忽然变了，有『忽如一夜春风来』的感觉。以前是知道有这么些事儿，藏着掖着谁都不说明白，资深的自己玩儿，小弟捡漏，群众连瓜在哪儿都不一定知道。现在是感觉被子掀开，太阳晒进来，虫子晒死一堆——还有大虫子，而侥幸活着的挪个地儿，继续往阴暗处爬。照这趋势，被子迟早彻底掀开，那会儿会怎么样，真不知道。就我知道，<a href="https://kb.iweb.com/hc/en-us/articles/230268268-GHOST-glibc-gethostbyname-buffer-overflow-CVE-2015-0235-" target="_blank" rel="noopener">glibc 的 hostname resolve 漏洞</a>和 <a href="http://heartbleed.com/" target="_blank" rel="noopener">openssl 心脏滴血</a>都是开胃菜。想对隐藏的『大 boss』有直观感觉，请看斯诺登泄密的那些文件。</p>
<p><strong>开源可持续的其中一个前提是：大多数贡献者积极向善</strong>。就像最近很火的<a href="https://www.zhihu.com/question/31112808/answer/122099628" target="_blank" rel="noopener">区块链</a>，确保账本正确、资金安全的前提是，不诚实节点掌握不了超过全网 50% 的运算力。否则，保存在全网区块链中的账本，被人篡改的几率就大大增加，账本不可信，资金不安全，你账户里面躺着的钱有一天会突然变成 TA 的。随着这些年技术门槛降低，互联网开始普及，互联网经济不再神秘，趋金的商人也越来越多走进来，捞钱。他们在互联网经济中所占的比例会越来越大，最后他们的影响力一定会超过作为『互联网原住民』的工程师。<strong>趋金</strong>不是个贬义词，由它引发的故事却往往是贬义的。这些故事，最终可能会<strong>毁了</strong>开源，或者说『<strong>进化</strong>』开源。</p>
<p>阳光下的 M$ 这么多金，届时 M$ 会不会趁虚而入要了这只企鹅的命，还真不好说。</p>
<p>看开点，随个缘咯。</p>
<hr>
<p>selinux 也是可怜的孩子，生不逢时。网上的小白教程讨论的都是『怎么关闭 selinux』，知乎上也只有『<a href="https://www.zhihu.com/question/20559538" target="_blank" rel="noopener">为什么要关闭 selinux</a>』这一类的问题。</p>
<p>在技术发展水平不变的前提下，安全和方便是一体的两面，要想安全，一定会比较麻烦；想不麻烦，就会不安全。可以选择权衡，本质不会变。没有环境倒逼，恐怕很多企业都不会对安全太上心，这就是现状。安全是非功能需求，往往也是次要需求，安全对应的麻烦则被视为成本，追求『绝对安全』的动力不足，只要相对安全就好。而且，这种『相对』的标准，往往还是领导/客户心理上的相对，跟事实差好远。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/apply-http-ssl-cert-file-from-a-non-beian-aliyun-ecs/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/apply-http-ssl-cert-file-from-a-non-beian-aliyun-ecs/" itemprop="url">阿里云未备案云主机申请 letsencrypt ssl 证书</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-31T00:34:22+08:00">
                2017-07-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/apply-http-ssl-cert-file-from-a-non-beian-aliyun-ecs/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/apply-http-ssl-cert-file-from-a-non-beian-aliyun-ecs/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>用阿里云国内机房的主机有个『小问题』，备案。下面说的，一种情况是没有备案，另外一种情况是备案中，但是业务急于对外发布，等不及以周为单位的备案进程。</p>
<p>访问绑定到阿里云 ECS 上的、没有备案的域名，阿里云机房会劫持你的 http（80 端口）上行流量，无视你实际的返回内容，将之篡改成一个页面 title 为『TestPage』的<em>温馨提示</em>（如下图）。</p>
<p><img src="./TestPage.png" alt="TestPage Screenshot"></p>
<p>而一台不能提供 http 服务的阿里云 ECS 不是真正的服务器。解决这个问题的办法，将 http 换到 https 就可以了。</p>
<h2><span id="https-选哪家">https 选哪家</span></h2><p>总所周知，自从 WoSign 被我大天朝数字公司收购之后，颇多周折，<a href="https://www.sslchina.com/chrome-final-removal-of-trust-in-wosign/" target="_blank" rel="noopener">跟同袍兄弟 StarSSL 一起被业界良心 chrome 拉黑</a>。现在使用 WoSign 签发的 ssl 证书会被 chrome 直接判定为证书无效。</p>
<p>最近连商务范儿最重的 <a href="http://www.cnbeta.com/articles/soft/636841.htm" target="_blank" rel="noopener">Symantec 都被 chrome 一再警告之后拉黑</a>。除了认为 chrome 真任性之外，也提醒我们选择 ssl 服务商时一定要慎重。</p>
<p>目前来看，从个人到中小企业，<strong>最佳选择是 google 投资的 <a href="https://letsencrypt.org/" target="_blank" rel="noopener">Let’s Encrypt</a></strong>。运用 ACME 协议自动签发、自动续期，技术宅最爱，不是技术宅也有现成工具简单操作即可。</p>
<h2><span id="怎么生成-http-ssl-证书">怎么生成 http ssl 证书</span></h2><p>首先注明，申请 Let’s Encrypt 家的 http ssl 证书，不需要提前准备啥资料，不需要书面申请，这跟国内的『管理』方法不一样。你只需要证明这个域名归你所有，http ssl 的证书就可以签发给你使用。但是为了防止域名到期易主、中途转让等等原因，发生域名新主人拿不到 http ssl 证书的情况，所以 <strong>Let’s Encrypt 规定了每次签发的 http ssl 证书有效期只有三个月，证书生成一个月之后可以免费重签/续期，不用等到临近有效期再续签</strong>。</p>
<p>Let’s Encrypt 验证域名的归属有两个办法，用过 Google Analytics，和用 G Suite 绑定过域名的朋友应该比较熟悉了。</p>
<ol>
<li>网站验证。给你一个随机内容的文件，你把这个文件放在一个特定的位置，用待绑定的域名 + 特定 path 可以访问到这个文件，可以认为域名是你的；</li>
<li>DNS 验证。给你一个随机字符串，你把这个字符串添加为待绑定域名某个 name 的 txt 值，只要能通过公网上的 DNS 服务器解析到这个字串，认为域名是你的。</li>
</ol>
<p>很简单吧。</p>
<p>在阿里云 ECS 未备案的情况下，第一种办法是不可行的，chanlledge 必须是用过 http 协议进行的（你是来申请 https 证书的，假设你还没有 https 服务，这完全正常，只能用 http 来 chanlledge），而你的 http 服务被阿里云劫持了，所以你才要申请 http ssl 证书。…… 这就是个死循环。</p>
<p>第二种办法可行，它的具体步骤如下。</p>
<h2><span id="具体操作">具体操作</span></h2><blockquote>
<p>我先把要注意的事项写下来，免得走弯路。<br>嗯，其实就一条：使用 <code>pip install certbot</code> 命令安装 certbot，不要用 yum/dnf/apt/pkg/apk 等包管理工具安装。</p>
</blockquote>
<h3><span id="第一步安装-certbot">第一步，安装 certbot</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade certbot</span><br></pre></td></tr></table></figure>
<p>如果已经通过包管理工具安装过 certbot，那么先卸载。假设在 CentOS 上，包管理工具是 dnf。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf remove -y certbot</span><br></pre></td></tr></table></figure>
<p>包管理工具安装的 certbot，其某些依赖包对应的版本比较低，存在兼容性问题，安装之后根本用不了。最好是用 pip 安装。</p>
<h3><span id="第二步提出签发-http-ssl-申请">第二步，提出签发 http ssl 申请</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --text --agree-tos --email &lt;your@email.com&gt; -d &lt;your.domain.com&gt; --manual --preferred-challenges dns --expand --renew-by-default  --manual-public-ip-logging-ok certonly</span><br></pre></td></tr></table></figure>
<p>注意，这时候会出现类似下面的内容。</p>
<blockquote>
<p>Please deploy a DNS TXT record under the name<br>_acme-challenge.bristol3.pki.enigmabridge.com with the following value:</p>
<p>667drNmQL3vX6bu8YZlgy0wKNBlCny8yrjF1lSaUndc</p>
<p>Once this is deployed,<br>Press ENTER to continue</p>
</blockquote>
<p>上面的内容意思是：</p>
<ol>
<li>背景：假设你申请 http ssl 的域名是 <code>bristol3.pki.enigmabridge.com</code>，你对这个域名有管理权；</li>
<li>在上述域名下，设置名为 <code>_acme-challenge</code> 的 <strong>txt</strong> 类型的记录，值为 <code>667drNmQL3vX6bu8YZlgy0wKNBlCny8yrjF1lSaUndc</code>；</li>
<li>如果上述记录是新建的，那么等待大约半分钟，回到命令行，点击<strong>回车</strong>继续。</li>
</ol>
<h3><span id="第三步获取-http-ssl-证书">第三步，获取 http ssl 证书</span></h3><p>完成之后，在 <code>/etc/letsencrypt/live/&lt;your.domain.com&gt;</code> 目录下，有这么几个文件。</p>
<ul>
<li><code>privkey.pem</code> 证书的私钥；</li>
<li><code>fullchain.pem</code> 带完整认证链的证书。注意，说是 fullchain，其实 CA 是 letsencrypt 自家的 CA，在某些老的操作浏览器上仍然有 bug；</li>
<li><code>chain.pem</code> README 上面说法是给 nginx stapling 用的，其实里面就是 letencrypt CA 的证书；</li>
<li><code>cert.pem</code> 域名的 http ssl 证书公钥。</li>
</ul>
<h3><span id="第四步安装">第四步，安装</span></h3><p>以 nginx 为例。（别问我为什么是 nginx，我最熟悉它，懒，你懂）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 只贴出关于 ssl 的部分，其余部分就不贴了。</span><br><span class="line">ssl on;</span><br><span class="line">ssl_certificate /etc/letsencrypt/live/your.domain.com/fullchain.pem;</span><br><span class="line">ssl_certificate_key /etc/letsencrypt/live/your.domain.com/privkey.pem;</span><br><span class="line">#  ssl_trusted_certificate /etc/letsencrypt/live/your.domain.com/fullchain.pem;</span><br><span class="line">ssl_trusted_certificate ssl/letsencrypt_full_chained.pem;</span><br><span class="line">ssl_stapling on;</span><br><span class="line">ssl_stapling_verify on;</span><br><span class="line">ssl_session_timeout 5m;</span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">ssl_ciphers HIGH:!aNULL:!MD5:!EXPORT56:!EXP;</span><br><span class="line">ssl_session_cache shared:SSL:50m;</span><br><span class="line">ssl_dhparam ssl/dhparams.pem;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br></pre></td></tr></table></figure>
<p>其中，<code>ssl/letsencrypt_full_chained.pem</code> 是让 ISRG ROOT X1 给 letsencrypt X3 做一个交叉认证的认证链，这是 CA 之间经常使用的一种提高自身兼容性的办法。这个交叉认证证书用如下办法生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo <span class="string">"<span class="variable">$&#123;HOME&#125;</span>/lets-encrypt-x3-cross-signed.pem"</span> \</span><br><span class="line">    <span class="string">"https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem"</span></span><br><span class="line">curl -Lo <span class="string">"<span class="variable">$&#123;HOME&#125;</span>/isrgrootx1.pem"</span> \</span><br><span class="line">    <span class="string">"https://letsencrypt.org/certs/isrgrootx1.pem"</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'s@\s*$@@g'</span> <span class="string">"<span class="variable">$&#123;HOME&#125;</span>/isrgrootx1.pem"</span>   <span class="comment"># trip the carrige at the end of every line.</span></span><br><span class="line">cat <span class="variable">$&#123;HOME&#125;</span>/lets-encrypt-x3-cross-signed.pem <span class="variable">$&#123;HOME&#125;</span>/isrgrootx1.pem &gt; \</span><br><span class="line">    letsencrypt_full_chained.pem</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS: 上面的命令简单粗暴，原因是假设 certbot 生成的 fullchain.pem 里面有以下的规则。</p>
<ol>
<li>域名 http ssl 都是由 letsencrypt CA 直接认证的，没有中间的 issuer；</li>
<li>签发证书的 letsencrypt CA 是 lets-encrypt-x3。</li>
</ol>
<p>所以，当上面的配置出现错误时，快糙猛的办法是屏蔽掉『ssl_trusted_certificate』这行。<br>毕竟，在功能性面前，兼容性算个逑。</p>
</blockquote>
<p><code>ssl/dhparams.pem</code> 由以下命令生成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl dhparam -out dhparam.pem 2048</span><br></pre></td></tr></table></figure>
<p>配置完成之后，reload nginx 即可。</p>
<p>自此，阿里云 ECS 终于可以通过 https 协议访问了。舒心啦。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/check-in-app-accessing-with-openresty/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/check-in-app-accessing-with-openresty/" itemprop="url">用 openresty 来做 app api 接口的验真</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-25T12:37:04+08:00">
                2017-07-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/check-in-app-accessing-with-openresty/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/check-in-app-accessing-with-openresty/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>app 服务器端的开发中，有一个百年不变的小东西：api 访问的验真问题。因为 http 协议是无状态的，每次 app 发起请求，我都需要验证这次请求的确是由真实的、授权的 app 发起，以此来阻止不诚实用户发起的攻击、数据爬取，确保产品的安全，和用户在产品上的信息安全。</p>
<p><a href="https://jwt.io/" target="_blank" rel="noopener">JWT</a>（JSON Web Token）是一个 http 之上的不错的 api 验真协议，结合 https，几乎可以安全地传输各种数据。最关键是，它原理简单，没用到啥黑科技，新瓶装老酒，但实用。</p>
<p><a href="https://openresty.org/cn/" target="_blank" rel="noopener">openresty</a> 是春哥做的一款神器，在 nginx 上挂了个 lua 引擎，可以用 lua 脚本指挥 nginx 做很多事情。了解 lua 的童靴都知道，lua 的执行性能堪比 C++/Java 这些编译型语言，大家在一个量级。能做到这步，已经相当感人。用 openresty 来实现 jwt 协议，做 api 访问的验真，可以降低后台系统的复杂程度，同时还能提高系统鲁棒性，防止被恶意攻击时系统雪崩。</p>
<p>现在已经有 openresty 的 jwt 模块，叫 <a href="https://github.com/SkyLothar/lua-resty-jwt" target="_blank" rel="noopener">lua-resty-jwt</a> 的，还有基于它做了二次封装的 <a href="https://github.com/ubergarm/openresty-nginx-jwt" target="_blank" rel="noopener">openresty-nginx-jwt</a>。</p>
<p>有了这个 jwt 的 openresty 模块，可以在 http server 这一层对 api 访问做验真，业务系统接收到的请求理论上都是真实的，避免调用庞大的业务系统做验真。这在收到 api 攻击的时候效果最明显，那时每次调用庞大的业务系统，加载若干组件，仅仅做了一次验真，然后就释放资源，销毁请求。简直是罪过。</p>
<p>话分两头说，直接上这个 jwt 模块存在一些风险。要在生产环境使用 jwt，还有一些工作必须做。</p>
<ol>
<li>secret 的策略。jwt 协议中，并没有规定 secret 怎么来的，实际操作中，不同的 secret 策略会有不同的效果。<ul>
<li>整个系统使用一个固定的 secret。不诚实用户可以注册账户，暴力穷举或内存搜索，得到 secret 明文。存在系统性风险。风险高。</li>
<li>一台服务器使用一个 secret，secret 写到 openresty 的配置中。仍然有上述问题，还增加了做负载均衡的难度。风险高。</li>
<li>一个用户一个 secret，openresty 根据用户信息取 secret 编解码。风险低，复杂度高。</li>
</ul>
</li>
<li>api 访问日志需要保存。特别对验真失败的访问，要能有手段及时处理日志，分析风险，对恶意用户可以屏蔽 IP 等手段规避。</li>
<li>经过验真的 api 访问日志结合静态资源访问日志，可以模拟真实用户的访问场景。结合 lazy load 等前端技术，甚至可以判断出用户究竟看了几页，资源加载速度快还是慢。这么好的资源，不能浪费。</li>
</ol>
<p>接上面。第一点好解决，一个 subrequest，或者单独给 lua-resty-jwt 一个 redis 存用户的 secret，就行了。第二点和第三点说的其实是一件事情，记日志，而且是把验真失败和验真成功的日志分开记。验真失败的日志需要参与在线准实时的计算，验真成功的日志打包保存，用来做离线的大数据分析，统计用户访问指标，优化产品。</p>
<p>一个小组件，挺好玩儿的一件事。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/user-only-equals-number/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/user-only-equals-number/" itemprop="url">用户就是个数字（外两则）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-30T14:16:45+08:00">
                2016-10-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/user-only-equals-number/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/user-only-equals-number/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>这两天有种忙得不亦乐乎的感觉，倦怠了写博客。</p>
<h2><span id="用户就是个数字">用户就是个数字</span></h2><p>要说的是关于鹅厂邮箱的事儿。标题是很多大公司做产品的哲学，当然也包括鹅厂自己家的。</p>
<p>我是鹅厂毕业，也算是鹅厂粉丝，但凡能鹅厂产品能满足要求的地方，就不会用别家的产品。企业邮箱就是一个例子。</p>
<p>我的个人常用邮箱以自己的域名作为后缀，最初放在腾讯邮箱的『企业邮箱免费版』上，用了有两年左右的时间，一直很正常。一直到这周朋友给我发送邮件，被退回来，提示邮箱不存在一类的错误。我才注意到，<strong>原来我的免费版的企业邮箱被腾讯单方面终止了服务，正在使用中的邮箱无法收发邮件，甚至无法登陆，从管理后台登陆上去才了解到是域名无故被解绑。而在这之前，无论是我绑定了该企业邮箱的微信，还是企业邮箱本身，被抑或企业邮箱的管理账号，都没有收到任何相关的提示信息。</strong></p>
<p>我首先排除管理账号被盗、黑客为之的可能性。很简单，腾讯企业邮箱的那个管理账号我很长很长时间没有使用过，账号名是一个我从来没有在别的地方使用过的字符串，不存在被社工被钓鱼的可能性。而且管理后台中，我的企业邮箱绑定过三个域名，除开今年有一个因为域名到期没续费自动失效当即被清理，一个我一直在使用中的域名无故清除，只剩下一个绑定后几乎没有使用过的域名。如果是黑客捣鬼，为什么单独给我留一个没使用过的域名？这讲不通。</p>
<p>后来有朋友在朋友圈中留言，了解到原来有朋友也遇到过，也是腾讯企业邮箱免费版，绑定的域名下有一个用来做客服的邮箱，经常在登录使用，也是毫无预警的情况下被清理，并且也是从后台直接解除了整个域名的绑定。</p>
<p>不同的是，朋友用的邮箱在两个月前失效，我的邮箱是在一个月前失效。分批分次在清理免费邮箱——而且是<strong>不给你任何预警、提示、通告、宽限期、选择项……</strong> 直接让你的邮箱和邮件消失掉的清理。</p>
<p>到现在，这事儿几乎很明显是腾讯邮箱人为在清理的动作。因为太没底线了。按照腾讯一贯的价值观，这绝对不是一个『正直』的事情，这样的服务态度也不完全不符合『水和电』的特征，更加不『值得尊敬』。</p>
<p>在大厂做过 2C 产品的同学都知道，用户不过是一个庞大的数字，和员工自身利益休息相关的 KPI 也是通过评价这些数字，来调节对员工的奖惩。对于每一个单一的用户，大厂的产品真的是多你一个不多少你一个不少。</p>
<p>今天正好看到广研大 boss 张小龙在微信事业群管理大会上的一个演讲，<a href="http://mp.weixin.qq.com/s?__biz=MTE3MzE4MTAyMQ==&amp;mid=2651138374&amp;idx=2&amp;sn=15f7fefcb7bae4e160883ae0b37558b1&amp;chksm=76232c744154a562889646a2a21f22588961132b943056a3578275d47f14058492785945ad9e&amp;mpshare=1&amp;scene=1&amp;srcid=1030ou2wbXq0myYXdiIm8gkI#rd" target="_blank" rel="noopener">明确要求内部不要盲从流程和 KPI，要坚持用户价值导向</a>。真的说得很好。他还特别举了 QQ 邮箱的例子，这是个大家都比较熟悉的例子。当年 QQ 邮箱从上不了邮箱服务 Top10 排名到后来逆袭压倒 Hotmail 和网易邮箱，方法是小团对敏捷开发，背后的思想仍然是坚持用户价值导向。如果企业邮箱的团队能够坚持用户价值导向，是一定不会做这么出格的事情。</p>
<p>希望老东家能越来越好。千万守住自己的底线。</p>
<hr>
<h2><span id="139-邮箱之乱象">139 邮箱之乱象</span></h2><p>又是邮箱的故事。</p>
<p>我的 139 邮箱在 2014 年设置过一个别名，这样可以用英文名而不是手机号作为邮箱前缀，识别度更高。我拿 139 邮箱主要是在国企那段时间用来收发工作上的邮件。</p>
<p>然而自开通邮箱别名开始，就经常收到一些莫名其妙的邮件，邮件经常开头有名有姓，称谓是我没听过的名字。刚开始以为是骚扰邮件，没有管，后面类似的邮件来得越来越多，我也听之任之，反正这个邮箱后来几乎就没有怎么用过了。</p>
<p>这周忽然收到一封邮件，是<a href="https://weibo.com/" target="_blank" rel="noopener">微博</a>发送的，提醒我登录别名邮箱对应的微博账号。很奇怪，我不可能用 139 邮箱注册微博账号。担心邮箱帐密被盗用作什么不好的事情，于是通过微博的找回密码服务找回了账号对应的密码（后来知道，微博账号如果没有绑定手机，那么别人拿到你的邮箱，随便使用一个手机也能找回密码），发现是一个运营了三四年的企业微博，企业地址在上海。到此我才恍然大悟。</p>
<p><strong>在我设置 139 邮箱别名的时候，我设置的这个别名其实是有人在使用的。不知为何，139 邮箱仍然把这个别名分配给我。所以我经常收到本该属于另一个用户的邮件，而且猜想那个用户同时也能收到本该属于我的邮件吧。一个别名邮箱，我们俩都有在使用，不论谁发送邮件，我们俩都能收到。</strong></p>
<p>最后我给我们俩『共用』的别名邮箱发了消息，告诉他这个情况，并承诺把微博密码还给他。希望他能看到。</p>
<p>邮箱作为互联网基础服务，服务的稳定性应该要有最基本的保障，安全和隐私也应该要能做到最基础的保障。这跟邮局里面申请一个邮箱一样的。可是一周内竟然遇到两次大乌龙，我也是醉了。</p>
<p>所幸我还有一个 gmail 注册的企业邮箱。从今天起，免不了后续会逐步把常用邮箱换成那个。</p>
<p>在天朝，用个邮箱都能吓死宝宝。</p>
<hr>
<h2><span id="关于运维的笑话">关于运维的笑话</span></h2><p>有个运维跟中学同学聚餐，接了个电话，大家都吓尿了。。。。</p>
<p>『喂，是我。』<br>『怎么回事？……卡在哪儿了？』<br>『不行就杀了吧，做事别磨磨唧唧的。先保证业务正常。』<br>『啥？找不到？杀不了？你不知道 killall 啊！把这个名字的全干了。』<br>『嗯。』<br>『诶？怎么还报警了！』<br>『你让胡总赶紧把警报先关了。你就在现场，报警有个屁用。』<br>『你跟他好好说一下，就说是我说的。这破事儿二十分钟内就能搞定，不要动不动就报警。』<br>『嗯。』<br>『对，挂了也要拉起来，就没什么不行的！他敢挂掉你就再拉一个。』<br>『擦！早不挂晚不挂，这会儿挂，真特么不是时候！』<br>『行了，我马上过来。都特么不给老子清净！擦！』<br>………… (o_o)<br>『我不吃了，要去加个班。喂，你们都看着我干嘛…… 』</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/cold-knowledge-about-plane-taking-off/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/cold-knowledge-about-plane-taking-off/" itemprop="url">『东航两飞机险相撞』事件中的飞行知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T23:58:23+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/cold-knowledge-about-plane-taking-off/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/cold-knowledge-about-plane-taking-off/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>今天无意中打开 <a href="http://www.maxthon.cn/" target="_blank" rel="noopener">Maxthon</a>，看到了推荐的一则旧闻——<a href="http://www.yicai.com/news/5134973.html" target="_blank" rel="noopener">『东航两飞机险相撞』</a>。我记得事件当天就有看到这则报道，当时的第一反应是：类似<a href="https://zh.wikipedia.org/wiki/%E7%89%B9%E5%85%A7%E9%87%8C%E8%B2%BB%E7%A9%BA%E9%9B%A3" target="_blank" rel="noopener">荷兰皇家航空发生的空难（特内里费空难）</a>在虹桥机场被避免了。今天看到的更多是后续报道，新闻报道的焦点几乎都在 V5 的机长和疏忽的管制员身上。</p>
<p>俗话说，对航空航天没点儿兴趣的码农不是好的 CTO。凭借我多年积累的航空知识，和对航空事业发展的关注——其实就是对各城市机场航班老是延误的那点儿感性认知——跑道入侵征候（被规避了，不算空难）在今天不能算是罕见。不过这次这个事件号称是<strong>相差三秒相撞</strong>，事后也被定型为 <a href="https://zh.wikipedia.org/wiki/2016%E5%B9%B4%E8%99%B9%E6%A1%A5%E6%9C%BA%E5%9C%BA%E8%B7%91%E9%81%93%E5%85%A5%E4%BE%B5%E4%BA%8B%E4%BB%B6" target="_blank" rel="noopener">A 类跑道入侵事件</a>，说明事件本身还是非常严重的。</p>
<p>下面摘自<a href="http://www.thepaper.cn/newsDetail_forward_1544123" target="_blank" rel="noopener">澎湃新闻的后续报道</a>。</p>
<blockquote>
<p>通报称，这是一起塔台管制员遗忘飞机动态，违反工作标准而造成的人为原因严重事故征候。性质极为严重，属于A类跑道入侵，险些发生飞机相撞。当时两架飞机垂直距离仅19米，翼尖距13米，两机仅差约三秒就会发生碰撞。320机组果断处理，操纵正确，避免了一起事故。330机组接受了穿越跑道的错误指令后，虽然看到了飞机起飞，但并未提出质疑。</p>
<p>通报认为，管制员违反相关规定，盲目指挥，双岗制责任落实不到位；专业人员资质是重中之重，自制能力要跟上；管理手段和工作流程存在问题，要系统思考原因，加以改进。</p>
<p>通报还提到，330机组存在SOP的问题，观察不周，不按规定，关闭了应答机。带飞左副驾驶不知道东航穿越跑道程序。没有交叉检查，没有互相证实。但是机组没有机械听从塔台原地等待命令，加速穿越，避免了两机相撞，暴露了训练上的问题。320机组处理非常到位，临危决断，立了大功。副驾驶操纵迟疑，点了一下刹车，机长迅速接过操纵，以7.03度/秒的速率，带杆到机械止动位。</p>
</blockquote>
<p>首先明确了这是一起<strong>人为因素造成</strong>的事故，而且是<strong>塔台管制员疏忽占主因、A330 机组占次因</strong>的事故。事后调查表明，A330 机组存在 SOP 问题，以及观察不周、关闭应答机等问题。</p>
<p>其次，报道中提到了 A320 机组在事件中临机处置立了大功。<strong>7.03度/秒</strong>的速率，带杆到<strong>机械止动位</strong>，才避免了两机相撞的事故。当然，这其中还有一个明显的对比：『副驾驶操作迟疑，点了一下刹车』，后来『机长迅速接过操纵』，才避免了机毁人亡的悲剧。</p>
<p>这其中有多个航空相关的知识，自己也是边看新闻边搜索，记下来，也给其他有兴趣的朋友科普一下。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/post/cold-knowledge-about-plane-taking-off/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/another-package-management-tool-under-centos-named-dnf/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/another-package-management-tool-under-centos-named-dnf/" itemprop="url">另一个包管理工具——DNF</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-17T09:45:55+08:00">
                2016-10-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/another-package-management-tool-under-centos-named-dnf/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/another-package-management-tool-under-centos-named-dnf/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote>
<p>更新（2017-06-01）：repo 的 url 有变化，更新之。后附更新脚本。</p>
</blockquote>
<hr>
<p><a href="http://rpm-software-management.github.io/dnf/" target="_blank" rel="noopener">DNF</a> 起源于 YUM 的一个分支，最早用在 <a href="https://fedoraproject.org/" target="_blank" rel="noopener">Fedora</a> 18，在 Fedora 22 中默认安装，成为系统工具。<a href="http://www.tecmint.com/dnf-next-generation-package-management-utility-for-linux/" target="_blank" rel="noopener">现在更是被广泛看作 YUM 的接班人。</a>虽然 DNF 号称自己不错，但是幸好，至少从目前来看，都可以看做是对 YUM 的小修补。整体来说，DNF 对 YUM 的兼容做得很好，甚至于部分操作可以 <code>yum</code> 和 <code>dnf</code> 混合着来——当然，新旧掺杂绝对不是好习惯，我就这么一说，证明 YUM 和 DNF 的关联之亲近。用惯了 YUM 的朋友们一定不会抗拒换到 DNF，它们的<a href="https://linuxstory.org/dnf-commands-for-fedora-rpm-package-management/" target="_blank" rel="noopener">用法非常相似</a>，而且 DNF 的更有现代语言风格。</p>
<p>我常用的系统是 <a href="https://www.centos.org/" target="_blank" rel="noopener">CentOS</a>，虽然已经被 RedHat 收购，但是 CentOS 的品质和定位都没有变，这很难得。最新（截至 2016-10-16）的 CentOS 是 7.2.1511。下面的步骤在 CentOS 上尝试，对 Fedora/RHEL 理论上同样适用。Fedora 上应该还更加简单，下面的问题好多都不会遇到。</p>
<p>闲话不说，安装步骤如下。</p>
<h3><span id="一-手动安装全新的-yum-repo">一、手动安装全新的 yum repo</span></h3><p>新增一个 repo，从这个 repo 中用 <code>yum</code> 安装 DNF。这是因为 CentOS Base repo 中的 DNF 版本太低，只有 0.6.x，而最新的稳定版已经到 1.1.9。0.6.x 中的 libsolv 太低，<a href="https://gist.github.com/makeittotop/d83f53c5354f0e12fdc3cc394af9d1c5" target="_blank" rel="noopener">导致不能处理 <code>.bz2</code> 压缩包</a>，所以只能采用<a href="http://dnf.baseurl.org/2016/07/01/fresh-dnf-for-rhel-7-and-centos-7/" target="_blank" rel="noopener">引入新 repo</a> 来安装 DNF 的办法。</p>
<strike><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/dnf-stack-el7.repo</span><br><span class="line">[dnf-stack-el7]</span><br><span class="line">name=Copr repo <span class="keyword">for</span> dnf-stack-el7 owned by @rpm-software-management</span><br><span class="line">baseurl=https://copr-be.cloud.fedoraproject.org/results/@rpm-software-management/dnf-stack-el7/epel-7-\<span class="variable">$basearch</span>/</span><br><span class="line">skip_if_unavailable=True</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://copr-be.cloud.fedoraproject.org/results/@rpm-software-management/dnf-stack-el7/pubkey.gpg</span><br><span class="line">enabled=1</span><br><span class="line">enabled_metadata=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><br><br></strike>

<blockquote>
<p>Update (2017-06-03):<br>因为 rpm-software-management 提供的 repo 变更了 url，因此上述脚本也做了相应更新。如下。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/dnf-stack-el7.repo</span><br><span class="line">[dnf-stack-el7]</span><br><span class="line">name=Copr repo <span class="keyword">for</span> dnf-stack-el7 owned by @rpm-software-management</span><br><span class="line">baseurl=https://copr-be.cloud.fedoraproject.org/results/@rpm-software-management/dnf-centos/epel-7-\<span class="variable">$basearch</span>/</span><br><span class="line">skip_if_unavailable=True</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://copr-be.cloud.fedoraproject.org/results/@rpm-software-management/dnf-centos/pubkey.gpg</span><br><span class="line">enabled=1</span><br><span class="line">enabled_metadata=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>对于已经用旧的脚本安装过 dnf repo 的系统，可以使用下面的命令 fix。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[ -f /etc/yum.repos.d/dnf-stack-el7.repo ]] &amp;&amp; \</span><br><span class="line">  sed -i <span class="string">'s@/dnf-stack-el7/@/dnf-centos/@g'</span> /etc/yum.repos.d/dnf-stack-el7.repo</span><br></pre></td></tr></table></figure>
<h3><span id="二-安装-dnf">二、安装 DNF</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dnf dnf-conf dnf-automatic</span><br></pre></td></tr></table></figure>
<h3><span id="三-验证及状态检查">三、验证及状态检查</span></h3><p>安装完成后检查 DNF 的版本（如果报错，请看下一节）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf --version</span><br></pre></td></tr></table></figure>
<p>截至现在（2016-10-16），通过 <code>yum</code> 安装的 DNF 最新的版本号是 <code>1.1.9</code>，也就是说，你安装的 DNF 不应该低于这个版本号，才是对了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf repolist all</span><br></pre></td></tr></table></figure>
<p>这可以查看当前 DNF 用到那些软件库的资源。按照使用 YUM 的习惯，最重要的无非 Base、EPEL、Updates 这三个。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf list installed</span><br></pre></td></tr></table></figure>
<p>查看已经安装的应用。<br>PS：从第三列很容易看出，以前通过 YUM 安装的应用，都被划为 <code>@System</code>，即系统模块类别。这应该是为了能从 YUM 平滑过渡的一个折衷办法。</p>
<h3><span id="四-部分问题的解决更新中">四、部分问题的解决（更新中）</span></h3><h4><span id="1-failed-to-open-updateinfoxmlbz2错误">1. 『Failed to open: …..updateinfo.xml.bz2』错误</span></h4><p>这是由于<a href="http://unix.stackexchange.com/questions/250249/error-after-installing-dnf-on-centos-7#answer-273487" target="_blank" rel="noopener">低版本的 libsolv 库无法处理 bzip 压缩包形式的依赖关系造成的</a>，解决的办法不是升级 libsolv 库，貌似库文件一起被封装成 python package，做到 rpm 里面了。所以正确的方法是，按照上面的步骤一、二重新安装 dnf。重新安装之前，必要的话应该删除旧的 DNF 及其依赖。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum erase dnf dnf-conf dnf-automatic python-dnf &amp;&amp; \</span><br><span class="line">yum install dnf dnf-conf dnf-automatic</span><br><span class="line"><span class="comment"># python-dnf 会作为 dnf 的依赖自动被安装</span></span><br></pre></td></tr></table></figure>
<h4><span id="2-dnf-无法使用-epel-库">2. DNF 无法使用 epel 库</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum erase -y epel-release &amp;&amp; dnf install -y epel-release</span><br></pre></td></tr></table></figure>
<p>通俗来讲就是让 DNF 来维护索引。</p>
<h4><span id="3-no-such-command-xxx-please-use-usrbindnf-help">3. 『No such command: xxx. Please use /usr/bin/dnf –help』</span></h4><p>通常遇到这种情况，是没有安装 DNF 扩展导致的。用下面的命令安装上 DNF 扩展之后，问题就能顺利解决。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y dnf-plugins-core</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/chrome-failed-on-opening-https-pages-after-upgraded-os-to-macos-sierra/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/chrome-failed-on-opening-https-pages-after-upgraded-os-to-macos-sierra/" itemprop="url">MacOS Sierra 升级之后的坑</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-06T00:18:55+08:00">
                2016-10-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/chrome-failed-on-opening-https-pages-after-upgraded-os-to-macos-sierra/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/chrome-failed-on-opening-https-pages-after-upgraded-os-to-macos-sierra/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>今年六月，Apple 宣布要<a href="http://cn.engadget.com/2016/06/13/os-x-is-now-macos/" target="_blank" rel="noopener">把 MacBook 的 OS 名称从 OSX 改名为 MacOS</a>。为了体验第一代的 <a href="http://www.apple.com/macos/sierra/" target="_blank" rel="noopener">MacOS Sierra</a>，我也是第一时间选择了系统升级。2012 mid 的 MBP，升级到 MacOS，感觉我也有点拼了。</p>
<p>升级完之后总体感觉还好，几乎都在预期内。却是在升级完成后大约第三天遇到 Chrome 报错，而且是反复的、随机的报错：『ERR_NETWORK_CHANGED』和『ERR_CERT_DATABASE_CHANGED』，就这两个。第一个出现的时候，页面 load 失败；第二个错误出现一般都是 js 或者 css 等页面资源 load 不下来（但是在新窗口打开这些资源又都没有问题）。</p>
<p>找了一圈，国外的网友们普遍表示情绪很稳定，没有遇到过。难道只是我大兲朝人民会遇到？</p>
<p>一开始考虑过是最近倡导的 HTTP =&gt; HTTPS 运动，有部分网站匆忙升级，可能在主站和资源站（相当一部分网站会把静态资源放到 CDN 上）之间的 key chains 路径有冲突所致。<code>CERT_DATABASE_CHANGED</code> 应该也是差不多的意思——原谅我懒癌发作，没去挖 chromium 代码。</p>
<p>不过网站的配置有错，我也没辙。问题却总是要解决的，哪怕用什么讨巧的办法。于是，今天找到了 <a href="https://www.v2ex.com/" target="_blank" rel="noopener">V2EX</a> 上面的这个 issue<a href="https://www.v2ex.com/t/307911" target="_blank" rel="noopener">《MacOS Sierra 升级 CHROME 用 HTTPS 访问间歇性失败》</a>。原来已经有朋友<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=649253" target="_blank" rel="noopener">发现了罪魁祸首</a>，就是 Alipay 的安全控件。从评论区盆友们的反馈看，问题是已经解决了。</p>
<p>评论区给出手动解决的办法。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种办法：停用支付宝的安全控件</span></span><br><span class="line">sudo launchctl remove com.alipay.DispatcherService</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种办法：彻底删除（手动卸载）支付宝安全控件</span></span><br><span class="line">sudo rm -rf /Library/Application\ Support/Alipay &amp;&amp; \</span><br><span class="line">sudo rm -rf /Library/LaunchDaemons/com.alipay.DispatcherService.plist &amp;&amp; \</span><br><span class="line">sudo rm -rf ~/Library/LaunchAgents/com.alipay.adaptor.plist &amp;&amp; \</span><br><span class="line">sudo rm -rf ~/Library/LaunchAgents/com.alipay.refresher.plist &amp;&amp; \</span><br><span class="line">sudo rm -rf ~/Library/Internet\ Plug-Ins/aliedit.plugin &amp;&amp; \</span><br><span class="line">sudo rm -rf ~/Library/Internet\ Plug-Ins/npalicdo.plugin</span><br></pre></td></tr></table></figure>
<p>停用或者删除支付宝安全控件带来的安全隐患是，支付宝不能帮你『防止账户密码被木马程序或病毒窃取』。不过就像评论区里面另外一位朋友说的：</p>
<blockquote>
<p>现在支付宝都在手机上用，我碰上这个问题估计是历史遗留问题，否则我也不会中 alipay 的插件，我记得 macos sierra 禁用了一些低安全协议，估计插件还在用这些协议，就体现到这个上来了。</p>
</blockquote>
<p>支付宝产品安全策略的变化可以很清晰看出来，手机支付的方式越来越成为主流，而且相对也更为安全可靠。PC 端支付的机会越来越少，MacOS 上装不装、用不用支付宝安全控件，影响不大。跟 Chrome 抽风比起来，我更愿意卸载它。</p>
<p>持续观察一段时间之后，再做评论。</p>
<hr>
<p>PS：忽然好担心 https 还能不能用 proxy 方式的做 sniffer？开发调试怎么办？囧</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/shame-with-no-enemy/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/shame-with-no-enemy/" itemprop="url">『羞耻啊，我们居然没有敌人！』</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-29T15:43:34+08:00">
                2016-09-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/shame-with-no-enemy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/shame-with-no-enemy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote>
<p>这篇文章阐述的是对我整个职场影响较深的思想之一。当年上大学，从《读者》上第一次读到这篇文章，觉得貌似很有道理，记住了。进入职场后，发现这简直就是某些看似不可思议、却又一遍一遍发生的事实的背后真理。后来知道它还有『鲶鱼效应』、『逃离舒适区』、『可以共苦不能同甘』等等不同的称谓。</p>
<p>转载自<a href="http://www.infzm.com/content/10315" target="_blank" rel="noopener">《南方周末》电子版</a>。如有侵权请告知，会删除。</p>
</blockquote>
<p>我曾经在随笔中谈到过有关的士司机的经历。与其他城市相比，这种经历以发生在纽约的最为有趣，原因有三。</p>
<p>第一，纽约的司机来自世界各地，语言、肤色都各不相同；每个人都配有一张小牌子，上头写着自己的名字。因此，每次上车后，辨认他们究竟是土耳其人、马来西亚人、希腊人、犹太人还是俄罗斯人，就成了一件很有意思的事情。他们中的很多人总是通过“他们”自己的电台来相互联系，电台里说着他们的语言，播放他们的歌曲，因此，有时打的去中央公园就好像是打的在加德满都旅行。</p>
<p>第二，在纽约没有人把的士司机作为终身的职业，而只是把它当作一份临时工作；因此，坐在的士方向盘前方的有可能是一名学生、一位失业的银行员工或是一个刚来不久的移民。</p>
<p>第三，纽约的士司机总是成群结队地出现：在某个时期内，大部分司机都是希腊人，过一段时间后又变成了巴基斯坦人，之后又是波多黎各人，诸如此类。通过这一点我们可以观察到移民的浪潮以及各个种族的胜利：当某一群的士司机从这个行业消失时，就意味着他们碰到了好运气，声势壮大了，说明他们可能转移到烟草店、蔬菜店里工作，转移到城市的另一个区域生活，登上了一个新的社会台阶。</p>
<p>因此，除了能够观察的士司机个体的心理差异（有癔病患者，有厚道热情者，有投身政治者，有反对某主义者）之外，出租车更是一个观察社会现象的绝好场所。</p>
<p>上个星期，我碰到了这样一个司机：他是有色人种，名字很难拼，后来他告诉我他是巴基斯坦人。聊到这儿的时候，他问我是哪国人（纽约的外来人口相当多），我说我是意大利人，于是他就开始问我问题。看上去他似乎对意大利相当感兴趣，后来我才明白，他之所以有这么多问题，是因为他对意大利一无所知，既不知道意大利在哪儿，也不知道那里说什么语言（通常，当你告诉一个的士司机说在意大利人们讲意大利语时，他们都会感到很震惊，因为他们已经习惯性地认为全世界都在讲英语了）。</p>
<p>我快速向他描绘了一下，说意大利是一个半岛，中部是绵延的山脉，而周围则被一圈海岸线包围，那里有许多美丽的城市。当聊到意大利的人口时，他惊讶于意大利的人口居然那么少。随后他又问我意大利人是否都是白种人，还是多种族混杂，我向他大致解释说：起初，所有的意大利人都是白种人，但现在也有一些黑人，不过数量总比美国要少。他当然也想了解意大利有多少巴基斯坦人。我回答说，可能有一些，但比菲律宾人和非洲人要少。听了我的回答，他显得不太高兴，或许在想为什么他的民族不愿意去意大利这个国家。</p>
<p>我又傻乎乎地告诉他说意大利也有一些印度人，他立刻怒视着我：我不该把两个如此不同的民族相提并论，不该提起这个在他心目中如此低等的民族。</p>
<p>最后，他问起谁是我们的敌人。我问：“什么？”于是他耐心地向我解释说他想知道意大利人目前正和哪个民族进行战争，不管是为了领土争端、种族仇恨，还是边界侵略等其他原因。我说我们没和任何民族打仗。他继续耐心地问我谁是我们历史上的敌人，也就是那些和意大利人相互残杀的民族。我再次重申我们没有这样的敌人。最近的一场战争发生在五十多年前，即使是在那场战争里，我们也没有搞清楚过究竟谁是我们的敌人，谁又是我们的盟友。他对我的回答很不满意，并坦白地告诉我说他认为我在撒谎。一个民族怎么可能没有敌人呢？</p>
<p>那件事就到此结束了，我为本民族这种麻木的和平主义而多给了他２美金的小费。但我一下车就忽然想起了本应该在刚才告诉他，却一时没有想起的正确答案。这种现象被法国人称为“ｅｓｐｉｒｉｔ ｄ＇ｅｓｃａｌｉｅｒ（马后炮）”。</p>
<p>我应该告诉那个司机意大利人是有敌人的。但那种敌人却不是外来的敌人，他们也根本无法确定谁是自己的敌人，因为他们总是在内部持续地争斗。意大利人之间总是在斗争：城市跟城市斗，邪教与正教斗，阶级跟阶级斗，政党与政党斗，同一政党中的成员相互斗，大区跟大区争，政府跟司法部门争，司法部门又与经济部门争，国家电视台与私人电视台争，联合政府之间的成员互相争，部门与部门争，报纸与报纸争。</p>
<p>我不知道那个司机是否能听懂我这样的回答，但如果我刚才这样回答他，作为一个没有敌人的国家的公民，至少不会丢脸。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/wild-dog-and-white-rabbit-are-both-necessary-for-a-company/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/wild-dog-and-white-rabbit-are-both-necessary-for-a-company/" itemprop="url">读评：小白兔和野狗的生路何在？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-28T23:19:25+08:00">
                2016-09-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/wild-dog-and-white-rabbit-are-both-necessary-for-a-company/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/wild-dog-and-white-rabbit-are-both-necessary-for-a-company/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>最近被徐新女士的<a href="http://mp.weixin.qq.com/s?src=3&amp;timestamp=1474789057&amp;ver=1&amp;signature=*Vzpj8PL4YDboc7spZB5h51dt**EctE5Ao0HMqrR6GVRlQbegj6aEpjCduLXFu0DVZnTJK4QwJ5SXGOdHq957hbV560brFJTqvZ-DZ4JdTDB8kH7V77BgVGXfePJmv8whJaCTTOxEEoXtKmqabtcfQ==" target="_blank" rel="noopener">《用人问题上，“野狗”和“小白兔”都要干掉》</a>一文刷爆了朋友圈，有些很少转载鸡汤文的朋友也转发了这篇文章，且转载的朋友中几乎都是自己创业或做管理的朋友，看来此鸡汤很对大多数创业者、管理者的胃口。</p>
<p>虽然大家普遍觉得这碗鸡汤营养很好，我还是觉得它鸡精放太多——鲜而犯腻，而在这个食材也就是观点上有偏颇。从篇幅上看，徐新女士演讲稿关于人才怎么用的篇幅并不大，演讲稿的书面内容与标题表达出来的笃定语气不太相符，猜想这个标题是标题党后来扣上去的。不过影响这么大的文章，我还是想忍不住说两句。</p>
<h4><span id="首先要说的是分类的问题什么是小白兔员工什么是野狗员工">首先要说的是分类的问题：什么是小白兔员工？什么是野狗员工？</span></h4><p>按照前导文给出的答案，野狗员工<strong>业绩好，但价值观不好（人品不好，吃回扣等）</strong>，小白兔员工则<strong>兢兢业业，勤勤恳恳什么都好，价值观和勤奋都没有关系，就是人没有什么贡献</strong>。相对应的，<strong>价值观好、业绩好</strong>的是明星员工。</p>
<p>从定义中可以看出来，徐女士从价值观和业绩两个方面来评判一位员工属于哪一类型。虽然我并不觉得把所谓『价值观』列在对员工的评判维度——注意此处不是<em>评价维度</em>，评判带有判决或者盖棺定论的意味，因为这次评判是徐新女士建议对部分员工做处理的依据——里面是公平的，不过这个地方我就先不展开，姑且按照文中这个思路来。</p>
<p>补充一下，我也并不认为那些会<a href="http://wiki.mbalib.com/wiki/%E7%8C%B4%E5%AD%90%E7%AE%A1%E7%90%86%E6%B3%95%E5%88%99" target="_blank" rel="noopener">把『猴子』抛给领导</a>的员工属于小白兔员工，他们是小孩子和心机婊。我也不认为那些完全不能跟公司提供的平台和平共处、准备捞一票闪人的员工会是野狗，他们业绩再好也只是祸害。</p>
<h4><span id="其次我们做企业的目标到底是做事情还是甄选明星员工">其次，我们做企业的目标到底是做事情还是甄选明星员工？</span></h4><p>这个问题我想除了 HR 之外，大家应该都选择前者吧。如果两者有冲突，一定是先事情做好，活下来，再考虑打造明星团队。活下来，活得更好，才是我们创业的目的。专职打造明星团队是 MBA 做的事情。</p>
<p>那么我反问两句。第一，那么能够创造业绩的野狗员工为什么不能留？因为野狗员工会带坏企业氛围？那你一个管理者创始人干嘛去了？你招聘的 HR 干嘛去了？这个问题瞄准一个目标，你的企业到底是谁在影响团队。在回答之前，先好好想一想这个问题，出了野狗，到底是野狗的错，还是你的管理策略有失误。第二，兢兢业业做好本职工作的小白兔员工为什么没有业绩？难道兢兢业业不对吗？到底出了什么问题？这个问题瞄准的是，到底谁该对公司的战略和战术负责，是老板还是中层管理还是员工。同样，想一想再回答这个问题。</p>
<h4><span id="讲第三个问题之前先要搞清楚职场岗位职责分工是怎么回事以及为什么要有岗位职责的分工全体员工动员起来参与管理的阿米巴模式到底好不好">讲第三个问题之前，先要搞清楚职场岗位职责分工是怎么回事？以及为什么要有岗位职责的分工？全体员工动员起来，参与管理的『阿米巴模式』到底好不好？</span></h4><p>包括我身边一些朋友，哪怕他们自己身居企业高管的位置，仍然没有把『岗位』和『岗位职责』区分开来。比较有代表性的观念包括：『<em>我们一个创业小公司，搞那么多岗位干什么？谁意识到问题、谁有能力，谁补位就好了</em>』，以及『<em>「排除万难做好工作」、「创造条件也要上」是一线员工应该考虑的事情</em>』。我认为一个团队之所以为团队，不是一个团伙，很重要一点是团队更有『规矩』：分工明确，配合可靠。理想情况下，应该能够放心地把后背交给你的队友。在一个完整的团队中，一定要有清晰的分工界面，明晰每个岗位对应的职责。哪怕团队成员不多，我们可以一人多岗，也一定不能模糊岗位职责。唯有此，每个人才能清楚自己的前后左右都由谁负责，才知道一旦出了问题自己应该找谁沟通，才能放心而专注地完成自己份内的工作。也唯有此，团队整体效率才有可能等于或大于个人效率之和，发挥出协同效应。</p>
<p>有句话忘了谁说过，『没有做过好员工的老板都不是好老板』。这个『好老板』我理解不是指员工说老板好，而是这个老板能带领团队产出高业绩，带大家一起吃肉，这样的老板才配叫好老板。而一个做好过基层工作的老板，一定会给员工创造一个更专注本职工作的环境。在他的团队里，员工消耗在非工作沟通、管理甚至自我管理上的精力要尽可能地少，他的员工可以心无旁骛在本职工作上专注，全情投入，团队整体的价值是大于单个员工价值相加之和的。这样的团队，才是一个员工和领导各司其职的团队，才是一个上下层配合默契的团队，才能称得上是一个高效的团队。</p>
<p>其实不论什么样的团队，它比个人单打独斗更高级的地方都在于：团队合作的效率高于个人价值。一个团队，如果不关注产出成果的效率，而注重它究竟要是一个怎样的存在，这叫『买椟还珠』。所以，无论是小白兔还是野狗，只要做到让他在团队中充分发挥价值，让他对团队利大于弊，完全可以留，这不是什么一定会有冲突的事情。反之，用不好这类人，觉得不能用，辞掉就好。完全没必要上纲上线到把员工做一个分门别类来设置教科书。</p>
<p>至于最近看到有些公司又开始追捧<a href="http://wiki.mbalib.com/wiki/%E9%98%BF%E7%B1%B3%E5%B7%B4%E7%BB%8F%E8%90%A5" target="_blank" rel="noopener">阿米巴模式</a>，号称自己的团队平等、自经营和自管理等等，我想问的是：你的员工真的可以全情投入到你们的事业中去吗？你为创造这种全情投入的环境，做了些什么？假如他能全情投入工作，他的职业规划在你的设计中吗？社会的发展和同行的诱惑就在那里，总不能简单归结为个人差异，然后回避吧。</p>
<h4><span id="最后小白兔和野狗就一无是处了吗一定要除掉小白兔和野狗吗">最后，小白兔和野狗就一无是处了吗？一定要除掉小白兔和野狗吗？</span></h4><p>我自己带过各种团队，有自己培养的嫡系，有空降切别人的团队，有作为甲方带外包做项目，也有在被甲方指挥的外包团队里面干过…… 这么多经历总结起来就是，一个团队成员一定要具备多样性，这个团队才是完整的，才能有成长的生命力。<strong>一个团队的领导如果眼睛里揉不进沙子，对下属像处女座选媳妇儿一样追求完美二字，这个团队的效率和克服困难的能力，一定不会强。</strong></p>
<p>所以还是上面表达的观点。『有教无类』，关键看你怎么用。野狗员工为了业绩无所不用其极，他们为团队做了不好的示范，但他们也能帮你发现新的业务增长点；小白兔员工为了自己的安稳两耳不闻窗外事，做老郝先生做自己份内的工作，但他们通常也会承担别人不愿意干的脏活儿累活儿。只要不是特别抵触工作，或者处处与人为敌，每个人都可以有他的位置，就看做领导的怎么安置而已。</p>
<hr>
<p>PS：抢救出来的一篇文章，险些烂尾。做教训，牢记。<em>2016.09.28 于成都</em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://i.am.simonkuang.com/post/routines-from-the-title-of-technology-manager/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Simon Kuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旷{<i>氏</i> }淇元">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/routines-from-the-title-of-technology-manager/" itemprop="url">从技术管理 title 看公司的技术解题思路</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-19T21:43:57+08:00">
                2016-09-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/routines-from-the-title-of-technology-manager/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/routines-from-the-title-of-technology-manager/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>互联网技术线的职业发展轨迹到今天已经很清晰，大体来说两个选择，要么继续深入走技术专家路线，当个架构师、研发专家，向计算机科学家方向迈进，要么转管理路线，从小组长做起，向 CTO 迈进。</p>
<p>这是正向的。反向，从一家公司技术负责人的 title，也能看出这家公司在技术方面的解题思路及现状。</p>
<h4><span id="1-招聘组长-leader-主管的注意留意这家公司最近招聘攻城狮的岗位-jd">1、招聘组长 / leader / 主管的，注意留意这家公司最近招聘攻城狮的岗位 JD。</span></h4><p>通常直接在 JD 里面说招聘 leader 一类 title 的非大厂企业，通常的意思是：我们需要一名高级攻城狮。至于你能不能胜任 leader，需要在工作中观察。不过不管怎么说，能把 leader 提出来单独招聘，是有意识在补充团队的中坚力量，应该给个赞。</p>
<p>这一类企业，留意他们最近招聘攻城狮的 JD，一个是 JD 中的任职要求，是否有侧重点，是否描述清晰，大致可以看出这个团队遇到了什么问题。第二是看看攻城狮 JD 中的薪资范围，可以从侧面了解这家公司攻城狮的待遇水平，也可以看出公司对这个角儿的期望，是个管培生，骨干，还是个救火队长。</p>
<h4><span id="2-招技术总监的企业是希望用管理手段来修补技术问题">2、招技术总监的，企业是希望用管理手段来修补技术问题。</span></h4><p>技术总监的职责偏管理而非技术，这是大家都有共识的。公司少一个技术总监，言下之意就是公司觉得技术管理上出了点问题，需要个人来补救。再换个角度翻译就是：希望通过技术管理来提（ya）高（zha）技术团队工作效率。</p>
<p>走技术总监这条线，等于就是走技术管理路线了。而且，一定是管理工作大于技术工作。</p>
<h4><span id="3-招架构师-首席架构师-研发专家的通常是需要一个救火队长少数是准备做大~~~项目">3、招架构师 / 首席架构师 / 研发专家的，通常是需要一个救火队长，少数是准备做大~~~项目。</span></h4><p>架构师 / 首席架构师 / 研发专家这几个 title 是在技术线的，现实中很多企业里面已经是到技术线顶端了。</p>
<p>需要这类角色的企业，不少是需要一个能带队、独当一面的技术骨干，有不少企业在招聘的当下还面临一堆代码腐烂的系统，和一个问题重重的团队。能应聘这个职位的，跟应聘技术总监类似，入职后都要面临非常大的挑战，不同的是管理层的期望。能放出这个 title 的空缺，企业管理层是期望用技术的手段来解决现阶段面临的问题。</p>
<h4><span id="4-招-cto-的要么是一穷二白的创业小作坊要么是高管层对产品的把控已经一筹莫展">4、招 CTO 的，要么是一穷二白的创业小作坊，要么是高管层对产品的把控已经一筹莫展。</span></h4><p>首先明确，CTO 在一家职能完备的企业里面，是高管角色，背的业务指标的，关心的是产品技术团队为公司业务增长提供多大的助力，对一个产品能不能实现、实现得好不好，他不负直接责任只负管理责任。同时，也意味着 CTO 对公司的主要业务必须非常熟悉。</p>
<p>创业小作坊招 CTO，基本上都是期望用 title 吸引住人才；而稍大一点的企业招 CTO，释放出来的信号是，高管层希望有人能通过对产品工作全权负责，来保增长促发展。</p>
<p>不管怎么说，就像 Fenng 自身遭遇的事情一样，CTO 这个角儿不好做。</p>
<p>另外还有一种常见的技术高管 title，叫『技术 VP』。这个基本上是活儿照干，但是不享受最后胜利果实的意思。企业招这个角儿的意思通常是：需要这么一个背业务指标的技术高管，你很合适，但又觉得你对企业带来的收益不高，比如没有一个好履历不方便放出去拉融资，所以把 CTO 的位置空缺，等遇到更合适的人，随时把你一脚踢开。</p>
<p>如果不是公司大到一定份儿上，招这个角儿的公司都是在耍流氓。</p>
<hr>
<p>作为一名技术出身、想要升阶的求职者，首先搞清楚自己的期望，然后选择合适的职位去求职。不管最终选择什么样的岗位，都需要做好一件事：管理好别人的期望。而一个连自己的期望都管理不好的人，肯定没有办法管理好别人的期望。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="http://upload.jianshu.io/users/upload_avatars/69775/1a6d1438fd5d.jpg?imageMogr/thumbnail/90x90/quality/100" alt="Simon Kuang">
          <p class="site-author-name" itemprop="name">Simon Kuang</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/simonkuang" target="_blank" title="GayHub">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      GayHub
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.laruence.com/" title="Laruence" target="_blank">Laruence</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://openresty.org/download/agentzh-nginx-tutorials-zhcn.html" title="agentzh的Nginx教程" target="_blank">agentzh的Nginx教程</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html" title="gitflow-cheatsheet" target="_blank">gitflow-cheatsheet</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://my.oschina.net/yilian/blog/664632" title="TensorFlow入门教程" target="_blank">TensorFlow入门教程</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2005 &mdash; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Simon Kuang</span>

  
</div>


<script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
<script>
  if (window.mermaid) {
    mermaid.initialize({"startOnload":true});
  }
</script>



  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        




  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=56218002";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://kuangqiyuan.disqus.com/count.js" async></script>
    

    

  




	





  










  





  

  

  

  

  

  

</body>
</html>
