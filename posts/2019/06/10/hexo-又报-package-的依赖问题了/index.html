<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.80.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="因为 hexo 的 package 的依赖问题，特别是对彼此版本的依赖问题，折腾过两三次，一直没有特别好的解决办法。 node 本质上仍然是脚本语言，不像编译型语言，实在不行，"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="hexo 又报 package 的依赖问题了"><meta property="og:description" content="因为 hexo 的 package 的依赖问题，特别是对彼此版本的依赖问题，折腾过两三次，一直没有特别好的解决办法。 node 本质上仍然是脚本语言，不像编译型语言，实在不行，"><meta property="og:type" content="article"><meta property="og:url" content="http://i.am.simonkuang.org/posts/2019/06/10/hexo-%E5%8F%88%E6%8A%A5-package-%E7%9A%84%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98%E4%BA%86/"><meta property="article:published_time" content="2019-06-10T09:50:24+08:00"><meta property="article:modified_time" content="2019-06-10T09:50:24+08:00"><title>hexo 又报 package 的依赖问题了 | 流沙书斋</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.ce74a2661479d34141b5c018b4f25ba8292b5adeca6de5d7a1b5c4de41c8f25d.css integrity="sha256-znSiZhR500FBtcAYtPJbqCkrWt7KbeXXobXE3kHI8l0="><script defer src=/en.search.min.f43f864b87654ca005f7c22196b917bd947f349395341988d8c026de238f3eaf.js integrity="sha256-9D+GS4dlTKAF98IhlrkXvZR/NJOVNBmI2MAm3iOPPq8="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script defer src=/custom.min.85e1dbc39b23671ffbf52bcb831b12735ade63896b28278cfb69b35d2c870ee9.js integrity="sha256-heHbw5sjZx/79SvLgxsSc1reY4lrKCeM+2mzXSyHDuk="></script><script src=//kit.fontawesome.com/e81509d074.js crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>流沙书斋</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/><i class="menu-item-icon fa fa-fw fa-home"></i>首页</a></li><li><a href=/posts/><i class="menu-item-icon fa fa-fw fa-blog"></i>博客</a></li><li><a href=/topics/><i class="menu-item-icon fa fa-fw fa-book"></i>专栏</a></li></ul><ul><li><a href=https://github.com/simonkuang target=_blank rel=noopener><i class="menu-item-icon fa fa-fw fa-github"></i>Github</a></li><li><a href=https://www.zhihu.com/people/simonkuang target=_blank rel=noopener><i class="menu-item-icon fab fa-fw fa-zhihu"></i>知乎</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>hexo 又报 package 的依赖问题了</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><h1><a href=/posts/2019/06/10/hexo-%E5%8F%88%E6%8A%A5-package-%E7%9A%84%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98%E4%BA%86/>hexo 又报 package 的依赖问题了</a></h1><h5>2019-06-10</h5><div><a href=/categories/%E6%8A%80%E6%9C%AF/ class=categories>技术</a></div><div><a href=/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/ class=tags>碎碎念</a></div><p><p>因为 hexo 的 package 的依赖问题，特别是对彼此版本的依赖问题，折腾过两三次，一直没有特别好的解决办法。</p><p>node 本质上仍然是脚本语言，不像编译型语言，实在不行，还可以把 package 一个一个打成 binary，逐个消除 package 的依赖问题。node 做不到。当两个以上的 package 声明的依赖相互冲突时，这个项目基本上也就废了。没法儿正常使用了。</p><p>有人会问，怎么可能出现这样的情况？开发者发现不了吗？</p><p>开发者可能还真发现不了。首先，开发者的环境是既有的，是缓慢生长起来的，不是什么问题都能发现的。其次，CI 也不一定能发现问题。有些基础的 package 为了自身兼容性，对不同 node 环境做了兼容处理，在不同版本的 node 下，逻辑代码不同。再次，npm 的 <code>peerDependencies</code> 对 package 之间的依赖关系进行了解耦，有些依赖关系非强制，实际上是允许了冲突的存在。最后，node 的环境隔离方案，类似 <code>pyenv</code> 这样的，也有，非主流，而且治标不治本，仍然解决不了 package 之间的冲突。</p><p>之前我遇到的问题是 <code>peerDependencies</code> 导致的。今天遇到的问题，则是对 node 版本的声明导致的。</p><blockquote><p>error <a href=mailto:nunjucks@3.1.3>nunjucks@3.1.3</a>: The engine &ldquo;node&rdquo; is incompatible with this module. Expected version &ldquo;>= 6.9.0 &lt;= 11.0.0-0&rdquo;. Got &ldquo;12.4.0&rdquo;
error Found incompatible module</p></blockquote><p>我的 node 是通过
<a href=https://brew.sh/>HomeBrew</a> 安装的，latest，当前版本 <em>v12.4.0</em>。</p><p>对 node 一直有一点担心，然后这种担心在 2016 年左右，逐渐成了现实。那就是 npm 对 package 的依赖管理策略。越松散，越自由，就越极客，越小众；越独裁，越限制，就越方便，越大众。npm 很明显走前者的路线，而且偏向极端。我知道稍微有点能力的公司，用 RN/Vue/Angular…… 都是自己搭 package server，自己造 package。包括一些基础的 package。没别的，就为一条，质量可控。</p><p>我一个小小 blogger，只是 hexo 用用 node，都这么不爽，能体会到前端工程师的辛苦。</p><p>算了，及早拥抱
<a href=https://gohugo.io/>Hugo</a> 吧。省得折腾。</p></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents></nav></aside></main></body></html>