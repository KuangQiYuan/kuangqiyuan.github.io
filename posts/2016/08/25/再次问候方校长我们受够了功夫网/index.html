<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.80.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="(UPDATED) 2017-08-17: ssserver 提供服务器端的支持；sslocal 转本地 socks5 服务；再用 privoxy 提供 http/https proxy。 经过试验，这样的解决方案是最全面的了。 至于梯子哪家强，你问我，"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="再次问候方校长：我们受够了功夫网"><meta property="og:description" content="(UPDATED) 2017-08-17: ssserver 提供服务器端的支持；sslocal 转本地 socks5 服务；再用 privoxy 提供 http/https proxy。 经过试验，这样的解决方案是最全面的了。 至于梯子哪家强，你问我，"><meta property="og:type" content="article"><meta property="og:url" content="http://i.am.simonkuang.org/posts/2016/08/25/%E5%86%8D%E6%AC%A1%E9%97%AE%E5%80%99%E6%96%B9%E6%A0%A1%E9%95%BF%E6%88%91%E4%BB%AC%E5%8F%97%E5%A4%9F%E4%BA%86%E5%8A%9F%E5%A4%AB%E7%BD%91/"><meta property="article:published_time" content="2016-08-25T12:36:41+00:00"><meta property="article:modified_time" content="2016-08-25T12:36:41+00:00"><title>再次问候方校长：我们受够了功夫网 | 流沙书斋</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.ce74a2661479d34141b5c018b4f25ba8292b5adeca6de5d7a1b5c4de41c8f25d.css integrity="sha256-znSiZhR500FBtcAYtPJbqCkrWt7KbeXXobXE3kHI8l0="><script defer src=/en.search.min.f43f864b87654ca005f7c22196b917bd947f349395341988d8c026de238f3eaf.js integrity="sha256-9D+GS4dlTKAF98IhlrkXvZR/NJOVNBmI2MAm3iOPPq8="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script defer src=/custom.min.85e1dbc39b23671ffbf52bcb831b12735ade63896b28278cfb69b35d2c870ee9.js integrity="sha256-heHbw5sjZx/79SvLgxsSc1reY4lrKCeM+2mzXSyHDuk="></script><script src=//kit.fontawesome.com/e81509d074.js crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>流沙书斋</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/><i class="menu-item-icon fa fa-fw fa-home"></i>首页</a></li><li><a href=/posts/><i class="menu-item-icon fa fa-fw fa-blog"></i>博客</a></li><li><a href=/topics/><i class="menu-item-icon fa fa-fw fa-book"></i>专栏</a></li></ul><ul><li><a href=https://github.com/simonkuang target=_blank rel=noopener><i class="menu-item-icon fa fa-fw fa-github"></i>Github</a></li><li><a href=https://www.zhihu.com/people/simonkuang target=_blank rel=noopener><i class="menu-item-icon fab fa-fw fa-zhihu"></i>知乎</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>再次问候方校长：我们受够了功夫网</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#方法一修改下载程序配置>方法一：修改下载程序配置</a></li><li><a href=#方法二一次性方式>方法二：一次性方式</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1><a href=/posts/2016/08/25/%E5%86%8D%E6%AC%A1%E9%97%AE%E5%80%99%E6%96%B9%E6%A0%A1%E9%95%BF%E6%88%91%E4%BB%AC%E5%8F%97%E5%A4%9F%E4%BA%86%E5%8A%9F%E5%A4%AB%E7%BD%91/>再次问候方校长：我们受够了功夫网</a></h1><h5>2016-08-25</h5><div><a href=/tags/%E8%BF%90%E7%BB%B4/ class=tags>运维</a></div><p><blockquote><p>(UPDATED) 2017-08-17:
ssserver 提供服务器端的支持；sslocal 转本地 socks5 服务；再用 privoxy 提供 http/https proxy。
经过试验，这样的解决方案是最全面的了。</p><p>至于梯子哪家强，你问我，我不会不告诉你。O(∩_∩)O哈哈~</p></blockquote><p>对于功夫网不问青红皂白直接予以封杀的行为，程序猿的一贯态度是问候方校长。有些的确敏感的都不说了，facebook 旗下的工具网站
<a href=http://nuclide.io/>Nuclide</a> 也被封，之前还有
<a href=http://python.org/>Python</a> 因为一个特定版本号被封的往事…… 各种搞笑和不能理解的规则，生活在兲朝的程序猿这种生物天生比国外的低矮一截——纯粹因为生存环境的关系，导致看世界不完整。</p><p>前两天做
<a href=https://grpc.io/>grpc</a> 的调研，为了简洁，安装
<a href=https://pecl.php.net/package/gRPC>php-grpc</a> 时准备就直接用
<a href=https://brew.sh/>homebrew</a> 搞定。<code>brew install homebrew/php/php56-grpc</code>，一句命令安装，升级维护也省心。</p><p>可是安装 php-grpc 的依赖却出了问题。
<a href=https://github.com/google/protobuf>protobuf</a> 在 homebrew 中是从源码开始安装，用的是 protobuf 自带的 <code>autogen.sh</code> 脚本，脚本中正好从 <code>googlemock.googlecode.com</code> 域下载 <code>googlemock</code> 一个特定版本的发布包，因为 shell 默认不会走系统代理（我用 shadowsocks 科学上网，这是我的梯子，这是下面所列方法的前提。如果你连梯子都没有，可以不用往下看，没戏），会导致下载失败。</p><p>英雄汉不能被一泡尿憋死。折腾一会儿，终于找到办法。</p><p>后来想想，自动化脚本里面其实挺多这种应用场景的，没谁写个脚本还要兼顾其它国家特色网络，那技术宅成天别干别的事儿，光跟堂吉诃德战斗好了。因此，记一下吧，以后用得着。</p><p>下面提供两种办法供选用。两种都简洁，改动都不大，主要看应用场景和个人的习惯吧。</p><h3 id=方法一修改下载程序配置>方法一：修改下载程序配置
<a class=anchor href=#%e6%96%b9%e6%b3%95%e4%b8%80%e4%bf%ae%e6%94%b9%e4%b8%8b%e8%bd%bd%e7%a8%8b%e5%ba%8f%e9%85%8d%e7%bd%ae>#</a></h3><p>protobuf 安装脚本中的下载程序使用的是 <code>curl</code>，因此先得配置它。新增或修改 <code>~/.curlrc</code> 这个文件，加入 <code>socks5</code> 这个选项（因为 shadowsocks 是用的 socks5）。</p><pre><code class=language-conf data-lang=conf># 我用的是影梭，所以设置 socks5 选项
socks5 = 127.0.0.1:1080

# 如果用的是 http，设置 proxy 选项
proxy = 127.0.0.1:8080
</code></pre><p>如果有用到 <code>wget</code> 的话，需要修改 <code>~/.wgetrc</code> 这个配置文件。</p><pre><code class=language-conf data-lang=conf># proxy 配置按照类型设置。为了避免冲突，保留你需要的那个就好
https_proxy = http://proxy.yoyodyne.com:18023/
http_proxy = http://proxy.yoyodyne.com:18023/
ftp_proxy = http://proxy.yoyodyne.com:18023/

# 确保 proxy 生效
use_proxy = on
</code></pre><h3 id=方法二一次性方式>方法二：一次性方式
<a class=anchor href=#%e6%96%b9%e6%b3%95%e4%ba%8c%e4%b8%80%e6%ac%a1%e6%80%a7%e6%96%b9%e5%bc%8f>#</a></h3><p>一次性方式有个好处是，能够让设置仅仅在当前 shell 中生效，既不影响别的 shell，退出当前 shell 之后设置自动清除，自动还原的无害小精灵。</p><p>这是 curl 的。按照实际情况修改配置，然后直接在 shell 中运行即可。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># socks5 proxy</span>
alias curl<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;curl --socks5=127.0.0.1:1080&#39;</span>

<span style=color:#75715e># http proxy</span>
alias curl<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;curl -x 127.0.0.1:8080&#39;</span>
alias curl<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;curl -x username:password@127.0.0.1:8080&#39;</span>
</code></pre></div><p>下面是 wget 的。wget 用 socks5 的话要麻烦一点，因为 wget 本身不支持 socks5，需要使用一个工具做基础环境的转换，
<a href=http://tsocks.sourceforge.net/>tsocks</a>。我们假设用户解决了 tsocks 的安装问题。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 配置 tsocks 先</span>
<span style=color:#75715e>#cat /dev/null &gt; /etc/tsocks.conf   # 清空 tsocks 配置</span>
echo <span style=color:#e6db74>&#39;server = 127.0.0.1
</span><span style=color:#e6db74>server_type = 5
</span><span style=color:#e6db74>server_port = 1080
</span><span style=color:#e6db74>&#39;</span> &gt; /etc/tsocks.conf

<span style=color:#75715e># socks5 proxy。根据 tsocks 的使用方式做设置。</span>
alias wget<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tsocks wget&#39;</span>

<span style=color:#75715e># https/http/ftp proxy。根据需要选择其中一种</span>
export https_proxy <span style=color:#f92672>=</span> http://proxy.yoyodyne.com:18023/
export http_proxy <span style=color:#f92672>=</span> http://proxy.yoyodyne.com:18023/
export ftp_proxy <span style=color:#f92672>=</span> http://proxy.yoyodyne.com:18023/

<span style=color:#75715e># 显式使用 proxy</span>
alias wget<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;wget --proxy=on&#39;</span>
</code></pre></div><hr><p>PS：搞定功夫网，发现 php-grpc 会在编译环节出问题，引用 grpc 的函数报参数数量有误，应该是 grpc 版本不对。也许是我之前为了省事不想翻墙，在 homebrew 之外自己安装了别的版本的 grpc 造成的。还没来得及追。功夫网害人呐！</p></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#方法一修改下载程序配置>方法一：修改下载程序配置</a></li><li><a href=#方法二一次性方式>方法二：一次性方式</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>