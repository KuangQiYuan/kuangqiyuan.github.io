<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.80.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="今年六月，Apple 宣布要 把 MacBook 的 OS 名称从 OSX 改名为 MacOS。为了体验第一代的 MacOS Sierra，我也是第一时间选择了系统升级。2012 mid 的 MBP"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="MacOS Sierra 升级之后的坑"><meta property="og:description" content="今年六月，Apple 宣布要 把 MacBook 的 OS 名称从 OSX 改名为 MacOS。为了体验第一代的 MacOS Sierra，我也是第一时间选择了系统升级。2012 mid 的 MBP"><meta property="og:type" content="article"><meta property="og:url" content="http://i.am.simonkuang.org/posts/2016/10/06/MacOS-Sierra-%E5%8D%87%E7%BA%A7%E4%B9%8B%E5%90%8E%E7%9A%84%E5%9D%91/"><meta property="article:published_time" content="2016-10-06T00:18:55+00:00"><meta property="article:modified_time" content="2016-10-06T00:18:55+00:00"><title>MacOS Sierra 升级之后的坑 | 流沙书斋</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.ce74a2661479d34141b5c018b4f25ba8292b5adeca6de5d7a1b5c4de41c8f25d.css integrity="sha256-znSiZhR500FBtcAYtPJbqCkrWt7KbeXXobXE3kHI8l0="><script defer src=/en.search.min.f43f864b87654ca005f7c22196b917bd947f349395341988d8c026de238f3eaf.js integrity="sha256-9D+GS4dlTKAF98IhlrkXvZR/NJOVNBmI2MAm3iOPPq8="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script defer src=/custom.min.85e1dbc39b23671ffbf52bcb831b12735ade63896b28278cfb69b35d2c870ee9.js integrity="sha256-heHbw5sjZx/79SvLgxsSc1reY4lrKCeM+2mzXSyHDuk="></script><script src=//kit.fontawesome.com/e81509d074.js crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>流沙书斋</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/><i class="menu-item-icon fa fa-fw fa-home"></i>首页</a></li><li><a href=/posts/><i class="menu-item-icon fa fa-fw fa-blog"></i>博客</a></li><li><a href=/topics/><i class="menu-item-icon fa fa-fw fa-book"></i>专栏</a></li></ul><ul><li><a href=https://github.com/simonkuang target=_blank rel=noopener><i class="menu-item-icon fa fa-fw fa-github"></i>Github</a></li><li><a href=https://www.zhihu.com/people/simonkuang target=_blank rel=noopener><i class="menu-item-icon fab fa-fw fa-zhihu"></i>知乎</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>MacOS Sierra 升级之后的坑</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><h1><a href=/posts/2016/10/06/MacOS-Sierra-%E5%8D%87%E7%BA%A7%E4%B9%8B%E5%90%8E%E7%9A%84%E5%9D%91/>MacOS Sierra 升级之后的坑</a></h1><h5>2016-10-06</h5><div><a href=/tags/Macbook/ class=tags>Macbook</a></div><p><p>今年六月，Apple 宣布要
<a href=http://cn.engadget.com/2016/06/13/os-x-is-now-macos/>把 MacBook 的 OS 名称从 OSX 改名为 MacOS</a>。为了体验第一代的
<a href=http://www.apple.com/macos/sierra/>MacOS Sierra</a>，我也是第一时间选择了系统升级。2012 mid 的 MBP，升级到 MacOS，感觉我也有点拼了。</p><p>升级完之后总体感觉还好，几乎都在预期内。却是在升级完成后大约第三天遇到 Chrome 报错，而且是反复的、随机的报错：『ERR_NETWORK_CHANGED』和『ERR_CERT_DATABASE_CHANGED』，就这两个。第一个出现的时候，页面 load 失败；第二个错误出现一般都是 js 或者 css 等页面资源 load 不下来（但是在新窗口打开这些资源又都没有问题）。</p><p>找了一圈，国外的网友们普遍表示情绪很稳定，没有遇到过。难道只是我大兲朝人民会遇到？</p><p>一开始考虑过是最近倡导的 HTTP => HTTPS 运动，有部分网站匆忙升级，可能在主站和资源站（相当一部分网站会把静态资源放到 CDN 上）之间的 key chains 路径有冲突所致。<code>CERT_DATABASE_CHANGED</code> 应该也是差不多的意思——原谅我懒癌发作，没去挖 chromium 代码。</p><p>不过网站的配置有错，我也没辙。问题却总是要解决的，哪怕用什么讨巧的办法。于是，今天找到了
<a href=https://www.v2ex.com/>V2EX</a> 上面的这个 issue
<a href=https://www.v2ex.com/t/307911>《MacOS Sierra 升级 CHROME 用 HTTPS 访问间歇性失败》</a>。原来已经有朋友
<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=649253">发现了罪魁祸首</a>，就是 Alipay 的安全控件。从评论区盆友们的反馈看，问题是已经解决了。</p><p>评论区给出手动解决的办法。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 第一种办法：停用支付宝的安全控件</span>
sudo launchctl remove com.alipay.DispatcherService

<span style=color:#75715e># 第二种办法：彻底删除（手动卸载）支付宝安全控件</span>
sudo rm -rf /Library/Application<span style=color:#ae81ff>\ </span>Support/Alipay <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo rm -rf /Library/LaunchDaemons/com.alipay.DispatcherService.plist <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo rm -rf ~/Library/LaunchAgents/com.alipay.adaptor.plist <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo rm -rf ~/Library/LaunchAgents/com.alipay.refresher.plist <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo rm -rf ~/Library/Internet<span style=color:#ae81ff>\ </span>Plug-Ins/aliedit.plugin <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sudo rm -rf ~/Library/Internet<span style=color:#ae81ff>\ </span>Plug-Ins/npalicdo.plugin
</code></pre></div><p>停用或者删除支付宝安全控件带来的安全隐患是，支付宝不能帮你『防止账户密码被木马程序或病毒窃取』。不过就像评论区里面另外一位朋友说的：</p><blockquote><p>现在支付宝都在手机上用，我碰上这个问题估计是历史遗留问题，否则我也不会中 alipay 的插件，我记得 macos sierra 禁用了一些低安全协议，估计插件还在用这些协议，就体现到这个上来了。</p></blockquote><p>支付宝产品安全策略的变化可以很清晰看出来，手机支付的方式越来越成为主流，而且相对也更为安全可靠。PC 端支付的机会越来越少，MacOS 上装不装、用不用支付宝安全控件，影响不大。跟 Chrome 抽风比起来，我更愿意卸载它。</p><p>持续观察一段时间之后，再做评论。</p><hr><p>PS：忽然好担心 https 还能不能用 proxy 方式的做 sniffer？开发调试怎么办？囧</p></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents></nav></aside></main></body></html>