<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.80.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="NodeJS 真的很火，一把大火带热了一直被轻视的、几乎要被认为不是编程语言的前端语言 javascript。火是不是 NodeJS 烧起来的已经不重要，反正它在大火里"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="吐槽被NodeJS用滥的软件设计哲学"><meta property="og:description" content="NodeJS 真的很火，一把大火带热了一直被轻视的、几乎要被认为不是编程语言的前端语言 javascript。火是不是 NodeJS 烧起来的已经不重要，反正它在大火里"><meta property="og:type" content="article"><meta property="og:url" content="http://i.am.simonkuang.org/posts/2017/08/27/%E5%90%90%E6%A7%BD%E8%A2%ABNodeJS%E7%94%A8%E6%BB%A5%E7%9A%84%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6/"><meta property="article:published_time" content="2017-08-27T00:54:40+00:00"><meta property="article:modified_time" content="2017-08-27T00:54:40+00:00"><title>吐槽被NodeJS用滥的软件设计哲学 | 流沙书斋</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.90625d9fbb472b5f34fb5ba5842114a94d178eb68035d6dd2a9154e8b9bb1849.css integrity="sha256-kGJdn7tHK180+1ulhCEUqU0XjraANdbdKpFU6Lm7GEk="><script defer src=/en.search.min.1e8240e6ae2811912e6fdad8b3c953ce11f3b0b2fd0ecfc2fe6c89126a8d4b72.js integrity="sha256-HoJA5q4oEZEub9rYs8lTzhHzsLL9Ds/C/myJEmqNS3I="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script defer src=/custom.min.85e1dbc39b23671ffbf52bcb831b12735ade63896b28278cfb69b35d2c870ee9.js integrity="sha256-heHbw5sjZx/79SvLgxsSc1reY4lrKCeM+2mzXSyHDuk="></script><script src=//kit.fontawesome.com/e81509d074.js crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>流沙书斋</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/><i class="menu-item-icon fa fa-fw fa-home"></i>首页</a></li><li><a href=/posts/><i class="menu-item-icon fa fa-fw fa-blog"></i>博客</a></li><li><a href=/topics/><i class="menu-item-icon fa fa-fw fa-book"></i>专栏</a></li></ul><ul><li><a href=https://github.com/simonkuang target=_blank rel=noopener><i class="menu-item-icon fa fa-fw fa-github"></i>Github</a></li><li><a href=https://www.zhihu.com/people/simonkuang target=_blank rel=noopener><i class="menu-item-icon fab fa-fw fa-zhihu"></i>知乎</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>吐槽被NodeJS用滥的软件设计哲学</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><h1><a href=/posts/2017/08/27/%E5%90%90%E6%A7%BD%E8%A2%ABNodeJS%E7%94%A8%E6%BB%A5%E7%9A%84%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6/>吐槽被NodeJS用滥的软件设计哲学</a></h1><h5>2017-08-27</h5><div><a href=/tags/%E5%89%8D%E7%AB%AF/ class=tags>前端</a></div><p><p><a href=https://nodejs.org/>NodeJS</a> 真的很火，一把大火带热了一直被轻视的、几乎要被认为不是编程语言的前端语言 javascript。火是不是 NodeJS 烧起来的已经不重要，反正它在大火里面烧得火红火红。</p><p>NodeJS 的包管理工具
<a href=https://www.npmjs.com/>npm</a>（Nodejs Package Management）在这其中功不可没。</p><p>直到 2016 年初，有一个很硬的程序猿
<a href=https://twitter.com/afrikaradyo>Azer</a>，非常不满自己的权益没有被 npm 这个平台正确对待——具体说，就是 npm 收到另外一个用户的律师信之后，擅自删除了前面这个 Azer 的 package，把 package 的名字直接转让给发律师信的用户管理——一气之下将自己创建并管理的所有 npm 上的项目全部 unpublish 了。这种行为在游戏里面叫自杀。关键人家还说挺对的：
<a href=https://medium.com/@azerbike/i-ve-just-liberated-my-modules-9045c06be67c>我解放了我所有的模块，因为我不会在一个某些人滥用特权的地方分享我的开源工作</a>。结果就比较搞笑了，因为其中一个被删除的模块
<a href=https://www.npmjs.com/package/left-pad>left-pad</a> 被大家广泛引用，导致 Babel、Ember、ReactNative 等等构建工具、框架，都不能正常使用。除了一些将 package 打包发布的应用，例如
<a href=https://atom.io>Atom</a>。这事儿在当时简直就是灾难，N 多前端程序猿被迫加班解决问题。</p><p>从这件事情之后，有些人也开始反思，于是知乎上有人问『
<a href=https://www.zhihu.com/question/41694868>如何看待 Azer Koçulu 删除了自己的所有 npm 库？</a>』这一类的问题。直到后来终于有人问：<strong>难道一个只有十一行代码的功能你们都不能自己写了么？</strong>（PS：left-pad 只有十一行有效代码）问题才逐渐回归本源上。</p><p>要我说，从我了解 npm 开始，就一直觉得它是 DRY（Donot Repeat Yourself）和 KISS（Keep It Simple, Stupid）的极端实践者。极端到什么地步呢，就像上面提到的，连一个十一行代码的功能都要找 npm 上面的 package 来实现，而不是自己写一份。层层叠叠，相互之间的引用关系堪比用 DNA 图谱勾勒人类进化史和迁移史。</p><p>现在看来，哲学是好的，但做得有点儿过。</p><hr><p>这两天被 npm 搞得够呛。</p><p>一直用
<a href=https://hexo.io>hexo</a> 写博客，好好的。手贱升级了 node 到 7.4.x，完了，发现不正常了，报类似下面的错误。</p><blockquote><p>Fatal error in ../deps/v8/src/api.cc, line 1051
Check failed: !value_obj->IsJSReceiver() || value_obj->IsTemplateInfo().</p></blockquote><p>在
<a href=https://github.com/nodejs/node/issues/10659>github 上找到答案</a>，升级 node 到 8.4.0 之后解决了问题。可是，今天升级 hexo 到 3.3.8 之后，又出现上面的问题。</p><p>从 github issue 和错误 stack 中已经知道是 fsevents 引发的问题，而且 fsevents 之前是经过大改的，版本有讲究。对这些历史了解很重要。</p><p>删除 node_modules 和 npm cache 之后重新安装 npm 模块，不行。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rm -rf .npm/ node_modules/ package-lock.json db.json
rm -rf ~/.npm/.cache
npm install
</code></pre></div><p>用
<a href=https://www.npmjs.com/package/yarn>yarn</a> 来安装。还是不行。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rm -rf .npm/ node_modules/ package-lock.json db.json yarn.lock
rm -rf ~/.npm/.cache
yarn install
</code></pre></div><p>连错误都一模一样。</p><p>直到用 <code>npm ls | grep fsevents</code> 命令，发现 fsevents 有两个版本，其中一个是 0.3.8——明显大改之前的。这时候，一个粗暴的办法出现在脑海里面。</p><p>在 iTerm3 里面快速定位到使用 <code>fsevents@0.3.8</code> 的组件，原来是 <code>hexo-github@1.0.1</code> 依赖的 <code>nunjucks</code> 这个库。</p><p>hexo-github 的作用是将 github 时间线展现在 blog 里面，非常适合程序猿出身的博主，但是我这会儿还没用上。所以先卸载吧。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm uninstall --save hexo-github
</code></pre></div><p><em>好吧，其实我是删除 node_modules 之后修改 package.json，再重装来的。:-P</em></p><p>总之，就好了。</p><p>hexo-github 的依赖关系指明依赖 <code>nunjucks@^1.3.4</code>，这好像是 <code>npm install --save nunjucks</code> 时会自动添加进 package.json 文件中的格式。默认格式。现在 nunjucks 的版本是 3.0.1，已经不在 1.x.x 这条主版本线上。所以，除非 hexo-github 的作者手动更新依赖中 nunjucks 的主版本号，否则就被栓死在 1.x.x 主线上。</p><p>万一真遇到 hexo-github 这样几乎已经不维护的 package，我真有自己 fork 一个库自己改的冲动。但这样又不 DRY 了，对吧？</p><p>心好累啊。[捂脸]</p></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents></nav></aside></main></body></html>