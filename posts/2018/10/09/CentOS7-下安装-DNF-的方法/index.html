<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.80.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="NOTE(simon): 讲啰嗦一点，方便搜索引擎收录关键字。需要解决方案的同学，可以直接拖到后半部分。 旧办法不灵 # 不知道什么原因，CentOS 7 下面安装 dnf 总是要出"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="CentOS7 下安装 DNF 的方法"><meta property="og:description" content="NOTE(simon): 讲啰嗦一点，方便搜索引擎收录关键字。需要解决方案的同学，可以直接拖到后半部分。 旧办法不灵 # 不知道什么原因，CentOS 7 下面安装 dnf 总是要出"><meta property="og:type" content="article"><meta property="og:url" content="http://i.am.simonkuang.org/posts/2018/10/09/CentOS7-%E4%B8%8B%E5%AE%89%E8%A3%85-DNF-%E7%9A%84%E6%96%B9%E6%B3%95/"><meta property="article:published_time" content="2018-10-09T13:39:35+00:00"><meta property="article:modified_time" content="2018-10-09T13:39:35+00:00"><title>CentOS7 下安装 DNF 的方法 | 流沙书斋</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.ce74a2661479d34141b5c018b4f25ba8292b5adeca6de5d7a1b5c4de41c8f25d.css integrity="sha256-znSiZhR500FBtcAYtPJbqCkrWt7KbeXXobXE3kHI8l0="><script defer src=/en.search.min.e9e22635e70f6b266439835f5f310e0afdac100a8577f9068b5ae0e2f166ab97.js integrity="sha256-6eImNecPayZkOYNfXzEOCv2sEAqFd/kGi1rg4vFmq5c="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script defer src=/custom.min.85e1dbc39b23671ffbf52bcb831b12735ade63896b28278cfb69b35d2c870ee9.js integrity="sha256-heHbw5sjZx/79SvLgxsSc1reY4lrKCeM+2mzXSyHDuk="></script><script src=//kit.fontawesome.com/e81509d074.js crossorigin=anonymous></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>流沙书斋</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/><i class="menu-item-icon fa fa-fw fa-home"></i>首页</a></li><li><a href=/posts/><i class="menu-item-icon fa fa-fw fa-blog"></i>博客</a></li><li><a href=/topics/><i class="menu-item-icon fa fa-fw fa-book"></i>专栏</a></li></ul><ul><li><a href=https://github.com/simonkuang target=_blank rel=noopener><i class="menu-item-icon fa fa-fw fa-github"></i>Github</a></li><li><a href=https://www.zhihu.com/people/simonkuang target=_blank rel=noopener><i class="menu-item-icon fab fa-fw fa-zhihu"></i>知乎</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>CentOS7 下安装 DNF 的方法</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#旧办法不灵>旧办法不灵</a></li><li><a href=#解决办法>解决办法</a></li><li><a href=#思考>思考</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1><a href=/posts/2018/10/09/CentOS7-%E4%B8%8B%E5%AE%89%E8%A3%85-DNF-%E7%9A%84%E6%96%B9%E6%B3%95/>CentOS7 下安装 DNF 的方法</a></h1><h5>2018-10-09</h5><div><a href=/tags/%E6%8A%80%E6%9C%AF/ class=tags>技术</a></div><p><blockquote><p>NOTE(simon): 讲啰嗦一点，方便搜索引擎收录关键字。需要解决方案的同学，可以直接拖到后半部分。</p></blockquote><h2 id=旧办法不灵>旧办法不灵
<a class=anchor href=#%e6%97%a7%e5%8a%9e%e6%b3%95%e4%b8%8d%e7%81%b5>#</a></h2><p>不知道什么原因，CentOS 7 下面安装 dnf 总是要出错，各种各样的问题与不兼容。CentOS 直到现在，还没有正式支持 dnf。相反，Fedora 22 开始就已经正式支持 dnf 作为默认的包管理工具了。差距啊。</p><p>之前试过用一个半官方的 dnf repo(
<a href=https://copr.fedorainfracloud.org/coprs/rpmsoftwaremanagement/dnf-nightly/>rpmsoftwaremanagement/dnf-nightly Copr</a>) 在 CentOS 7 下面安装 dnf，一直都是可以的。也可以正常升级。以前通过这个办法安装过 dnf 的系统，已经升级到 2.8.5。用起来很顺。</p><p>但是不知道为什么，最近用这个库，在全新的 CentOS 7 下面安装 dnf，遇到一个麻烦，就是包版本有冲突。类似的错误信息如下。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># yum install -y dnf-2.8.5-0.101g0f20917d.el7.centos</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.shu.edu.cn
 * epel: mirrors.yun-idc.com
 * extras: mirrors.163.com
 * updates: mirrors.163.com
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package dnf.noarch 0:2.8.5-0.101g0f20917d.el7.centos will be installed
--&gt; Processing Dependency: python2-dnf <span style=color:#f92672>=</span> 2.8.5-0.101g0f20917d.el7.centos <span style=color:#66d9ef>for</span> package: dnf-2.8.5-0.101g0f20917d.el7.centos.noarch
--&gt; Running transaction check
---&gt; Package python2-dnf.noarch 0:2.8.5-0.101g0f20917d.el7.centos will be installed
--&gt; Processing Dependency: rpm-plugin-systemd-inhibit <span style=color:#66d9ef>for</span> package: python2-dnf-2.8.5-0.101g0f20917d.el7.centos.noarch
--&gt; Running transaction check
---&gt; Package rpm-plugin-systemd-inhibit.x86_64 0:4.11.3-32.el7 will be installed
--&gt; Processing Conflict: python2-librepo-1.9.2-2gc670c6b.el7.x86_64 conflicts python2-dnf &lt; 2.8.8
--&gt; Finished Dependency Resolution
Error: python2-librepo conflicts with python2-dnf-2.8.5-0.101g0f20917d.el7.centos.noarch
 You could try using --skip-broken to work around the problem
 You could try running: rpm -Va --nofiles --nodigest
</code></pre></div><p>重点在这句，<code>librepo-1.9.2-2gc670c6b.el7.x86_64 conflicts python2-dnf &lt; 2.8.8</code>。</p><p>版本依赖关系树中提到的 <code>python2-dnf 2.8.8</code>，在 repo 中尚未发布。很明显的，dnf 2.8.5 依赖 python2-dnf 2.8.5 才对。事实也是，python2-dnf 最新的版本号是 2.8.5。</p><p>无论如何也解决不了这个难题。毕竟人家是 nightly，夹带一点私货也正常。</p><p>难道只能 build from source？不科学。dnf 是自展的，编译 dnf 需要用到 dnf。可手里是全新 CentOS 7。</p><ul><li>半官方的 dnf nightly repo。FAILED</li><li>build from source。FAILED</li></ul><h2 id=解决办法>解决办法
<a class=anchor href=#%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95>#</a></h2><p>然后，在找 dnf 2.7.5 rpm 的时候，被我发现一个隐藏的 repo。也算是半官方的吧。亲测可用。完美。用法如下。</p><blockquote><p>NOTE(simon): 2018-10-09 亲测有效</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat <span style=color:#e6db74>&lt;&lt;EOF &gt; /etc/yum.repo.d/another-dnf.repo
</span><span style=color:#e6db74>[another-dnf]
</span><span style=color:#e6db74>name=Another DNF Repo by CentOS.
</span><span style=color:#e6db74>baseurl=https://cbs.centos.org/repos/configmanagement7-dnf-common-release/\$basearch/os/
</span><span style=color:#e6db74>type=rpm-md
</span><span style=color:#e6db74>skip_if_unavailable=True
</span><span style=color:#e6db74>gpgcheck=0
</span><span style=color:#e6db74>repo_gpgcheck=0
</span><span style=color:#e6db74>enabled=1
</span><span style=color:#e6db74>enabled_metadata=1
</span><span style=color:#e6db74>EOF</span>
yum clean all
yum makecache fast
yum install -y dnf dnf-conf dnf-automatic dnf-plugins-core
</code></pre></div><p>这是个 ConfigManagement SIG 的社区项目，但是没有用 ConfigManagement SIG 的 GPG 证书签名，也没有出现在社区 wiki (
<a href=https://wiki.centos.org/SpecialInterestGroup/ConfigManagementSIG>SpecialInterestGroup/ConfigManagementSIG - CentOS Wiki</a>) 中，我理解属于边缘项目。不过依赖有效，能直接安装。</p><p>啥都不说了，只希望这次这个 dnf 的 repo 坚持久一点。</p><h2 id=思考>思考
<a class=anchor href=#%e6%80%9d%e8%80%83>#</a></h2><p>为什么 dnf 这么棒的工具在 Fedora 里面有，在 CentOS 里面就没有？我猜测，主要还是考虑稳定性。毕竟 CentOS 一直的策略都是以降级保稳定。dnf 还没过官方的考验期，所以一直没予以替换。既往所有的 repo 都是非官方的，最多也只能算是半官方的。</p></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><ul><li><a href=#旧办法不灵>旧办法不灵</a></li><li><a href=#解决办法>解决办法</a></li><li><a href=#思考>思考</a></li></ul></li></ul></nav></aside></main></body></html>